generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  name         String
  email        String         @unique
  passwordHash String
  integrations Integration[]  // <-- remove @relation(onDelete: Cascade)
  usage        Usage[]   // <-- remove @relation(onDelete: Cascade)
}

model Integration {
  id          String       @id @default(cuid())
  name        String
  type        String
  apiKey      String
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  alerts      Alert[]      // <-- remove @relation(onDelete: Cascade)
  usage       Usage[] // <-- remove @relation(onDelete: Cascade)
}

model Alert {
  id                 String      @id @default(cuid())
  integrationId      String
  integration        Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  threshold          Float
  type               String
  notificationMethod String
  triggered          Boolean? 
}

model Usage {
  id            String      @id @default(cuid())
  date          DateTime
  usage         Float
  cost          Float
  integrationId String
  integration   Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum AlertType {
  cost
  usage
}

enum NotificationMethod {
  email
  slack
}
